# Gulp-webpack-scss-babel-php 

Сборка сервера с LiveReload для проектов на php.

Ты ведь всегда хотел собирать ассеты для своего сайта на wordpress с помощью nodejs/webpack? Наслаждаться чудом liveReload и писать переменные через знак доллара? Тогда тебе сюда. 

## Основные фичи

⋅ SCSS

⋅ Babel

⋅ CommonJS/ES2015 модули 

⋅ Встроенный компактный php-сервер который запускается прямо из ноды

⋅ Возможность использовать кастомный php-сервер 


## Структура файлов
 

```gulpfile.js``` - основной файл Gulp с тасками. 

```webpack.config.js``` - конфиг вебпака для сборки javascript 

```.babelIrc``` - конфиг babel 

```php.ini``` - кастомный php.ini  

```src/scss``` - директория с исходниками scss. Собирается с помощью Gulp в директорию, которая указана в файле gulpfile.js

```src/js``` - директория с исходниками javascript. Собирается с помощью webpack-stream в директорию, которая указана в файле gulpfile.js. Точка входа - файл main.js. В виду сборки webpackом без проблем можно использовать npm-модули и писать ES2015 код (обрабатываются babel). 

```src/fonts``` - шрифты. Коппируются gulp в директорию которая указана в gulpfile.js 

```src/img``` - изображения. Обрабатываются gulp с progressive-png и кидаются в директорию, которая указана в gulpfile.js 

Для настройки структуры проекта можно изменять переменную PATH в файле gulpfile.js:

```javascript
const PATHS = {
    src: {
        scss: 'src/scss/main.scss', //точка входа scss
        js: {
            path: 'src/js/**/*.js', //путь к js файлам
            entry: 'src/js/main.js' //точка входа javascript
        }, 
        fonts: 'src/fonts/**/*.*', //шрифты
        img: 'src/img/**/*.*' //картинки
    },   
    webpackPublicPath: "/assets/js", //публичный путь для вебпака. Если ассеты будут лежать в папке отличной от assets необъодимо изменить на тот путь где они будут лежать 
    build: {
        css: 'assets/css', //куда собирать css
        js: 'assets/js', //куда собирать js
        fonts: 'assets/fonts', //куда коппировть шрифты
        img: 'assets/img' //куда коппировать изображения
    },      
    /* Пусти для отслеживания изменений */
    watch: {
        php: '*',
        js: 'src/js/**/*.js',
        scss: 'src/scss/**/*.scss',
        img: 'src/img/**/*.*',
        fonts: 'src/fonts/**/*.*'
    },    
}; 
```

Стоит помнить, что gulp соберет scss "как есть" и не будет изменять url к шрифтам и изображениям. Поэтому, при подключении шрифтов и картинок в scss (например для указания в background или иных целях) следует писать публичный путь до шрифтов и картинок относительно корня сервера. 
Например, в дефолтном состоянии когда ассеты собираются в каталог assets путь до шрифтов будет выглядеть как /assets/fonts. 

В виду того что пусть до ассетов в реальном проекте в принципе может измениться, хорошей идеей будет вынести этот путь в sass-переменную:
```scss
$ASSETS_PATH: "/assets";

body {
    background: url($ASSETS_PATH + '/img/test.png'); 
}
```

результат:
```css
body{
    background:url(/assets/img/test.png)
}
```

Следует быть осторожным и избегать двойных слэшей.

## Установка и запуск тасков 

1) ```npm install```

2) ```npm i gulp -g```

## Таски 

1) ```gulp sass``` - собирает scss
2) ```gulp js``` - собирает js 
3) ```gulp fonts``` - коппирует шрифты
4) ```gulp image``` - собирает картинки
5) ```gulp build``` - собирает все ассеты 

Таски для сборки полезно выполнить в самом начале проекта, когда галп не начал их отслеживать В остальных случаях следует просто работать с запущенным gulp-вотчером, который будет пересобирать ассеты при любом изменении файлов. 

Для работы с проектом на php имеется два варианта:
1) работать с использованием php-сервера gulp-php-connect со встроенным LiveReload 

2) работать с использованием произвольного php сервера настроив LiveReload через browserSync для своего сервера 

## Режим работы с простым gulp-php-connect сервером 

В первом случае следует просто запустить таск:
```gulp with-php-connect``` 

Галп автоматически 

1) запустит все вотчеры, следящие за всеми изменениями в рабочей директории

2) будет пересобирать на лету ассеты

3) поднимет php сервер на базе gulp-php-connect 

4) поднимет browserSync c liveReload, проксирующий все запросы к gulp-php-connect серверу и перезагружающий страницу в браузере при изменнии файлов в рабочей директории. 

Стоит заметить, что browserSync по сути своей "всего лишь" слушает событие data поступающее с вотчеров рабочей директории, перезагружает вкладку при срабатывании события data и проксирует запросы на gulp-php-connect сервер. 

```javascript
    gulp.task('php-server', () => {
        connectPHP.server({ 
            //router: 'index.php', //на этот файл будут отправляться все реквесты
            //ini: 'php.ini', //кастомный php ini
            base: '.',
            keepalive:true, 
            hostname: 'localhost', 
            port:8080, 
            open: false
        }, function() {
            browserSync({
                proxy:'127.0.0.1:8080'
            });
        });
    });
```
В реальном проекте простого сервера может быть недостаточно (в виду использования различных сложных модулей для пхп и прочего колдоства). В этом случае ничто не мешает использовать вместо gulp-php-connect свой любимый сервер (LAMP, openserver etc). 

## Режим работы с произвольным php-сервером 

1) Настроить свой любимый пхп-сервер на директорию развернутую из этого репозитория и запустить его 

2) В файле gulpfile.js прописать прокси на хост пхп-сервера:

```javascript
    gulp.task('custom-php-server', () => {
        browserSync({
            proxy:'127.0.0.1:3535' //myhost.ru, host:8080, etc
        });
    });
```

3) Запустить таск ```gulp custom-php-server```

4) наслаждаться LiveReload со своей любимой пыхой и сборкой ассетов с помощью ноды. 


